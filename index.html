<!DOCTYPE html>
<html lang="de">
<head>
         <title>Social Media Profile</title>
         <link rel="icon" type="image/svg+xml" href="favicon.svg">
         <link rel="icon" type="image/png" href="favicon.png">
         <link rel="shortcut icon" type="image/png" href="favicon.png">
         <link rel="apple-touch-icon" href="favicon.png" sizes="any">
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
         <link rel="stylesheet" type="text/css" href="style.css"/>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
         <link rel="manifest" href="manifest.json">
         <link href="https://fonts.googleapis.com/css2?family=Sora&display=swap" rel="stylesheet">
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
</head>
<body>
          <div id="loading-screen">
              <div id="loading"></div>
          </div>


          <div id="content">
              <div id="name">
                <img src="profilepicture.png" id="profilepicture">
                <p id="yourName">Your Name</p>
              </div>
              <div id="socialmedia">
              </div>
              <div>
              <a class="dark-toggle" href="#disclaimer" style="display:none;">Darkmode aktivieren <i class="fas fa-moon"></i></a>
              <p id="disclaimer" style="display: none;">
              Diese Funktion verwendet Cookies um abzuspeichern dass, Sie den Darkmode aktiviert haben. Ansonsten verwendet diese Seite keine weiteren Cookies.
              </p>
              </div>
          </div>



          <script>
          //loading
          $(window).on("load", function(){
            if(window.matchMedia('(prefers-color-scheme: dark)').matches || localStorage.getItem('darkmode') == "true"){
              document.body.style.setProperty('--button', '#181818');
              document.body.style.setProperty('--button-hover', '#202020');
              document.body.style.setProperty('--background', '#000');
            }

              if(window.location.search != ''){
                var url = window.location.search;
                var jsonurl = url.replace('?profile=', '');
                console.log("Load data from: " + jsonurl);
              }
              else{
                var jsonurl = "https://api.jsonbin.io/b/605f36879ab74a5f2bcccdda/1";
              }
              $.getJSON(jsonurl, function(data) {
                console.log("Get data from JSON File.")
                document.getElementById("yourName").textContent = data.name;
                document.body.style.setProperty('--theme', data.themecolor);
                //document.getElementById("creatorsname").href = data.creatorsurl;
                $("#profilepicture").attr("src", data.imageurl);
                document.title = data.name + "- Social Media Accounts";

                // load accounts
                var loopcount = 0;
                while (loopcount < data.totalaccounts) {
                    loopcount++;
                    var accounts = document.getElementById('socialmedia');
                    var newProfile = document.createElement('div');
                    let pageName = "page" + loopcount;
                    newProfile.id = pageName;
                    newProfile.className = "socialmedia-info";
                    // texts
                    var textloop = 0;
                    while (textloop < data.youraccounts[loopcount - 1].numberOfTexts) {
                        textloop++;
                        var newText = document.createElement('p');
                        if(textloop == 1){
                          newText.textContent = data.youraccounts[loopcount - 1].text1;
                        }
                        else if(textloop == 2){
                          newText.textContent = data.youraccounts[loopcount - 1].text2;
                        }
                        else if(textloop == 3){
                          newText.textContent = data.youraccounts[loopcount - 1].text3;
                        }
                        else if(textloop == 4){
                          newText.textContent = data.youraccounts[loopcount - 1].text4;
                        }
                        else if(textloop == 5){
                          newText.textContent = data.youraccounts[loopcount - 1].text5;
                        }
                        newProfile.appendChild(newText);
                    }
                    var newLink = document.createElement('button');
                    newLink.textContent = "Profil besuchen";
                    newLink.addEventListener("click", function(){
                      location.href = data.youraccounts[loopcount - 1].link;
                    });

                    newProfile.appendChild(newLink);
                    var newButton = document.createElement('button');
                    newButton.textContent = data.youraccounts[loopcount - 1].buttontext;
                    newButton.addEventListener("click", function(){
                      toggleInfo(pageName);
                    });
                    newProfile.type = "numbers";
                    accounts.appendChild(newButton);
                    accounts.appendChild(newProfile);
                }
              });



            $("#loading-screen").fadeOut(1000);
          });

          //toggle Info Fields
          function toggleInfo(infoName){
          	var infoName = '#' + infoName;
            $(infoName).toggle('fast', function(){
          	});
          }
          </script>
</body>
</html>
